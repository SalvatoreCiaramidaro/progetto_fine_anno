{% extends 'base.html' %}

{% block title %}{{ car.name }} - WikiSportCars{% endblock %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/car_detail.css') }}">
{% endblock %}

{% block content %}
  <h2>{{ car.name }}</h2>

  <div class="image-container">
    <button class="prev-btn" onclick="changeImage(-1)">&#10094;</button>
    <img id="carImage" src="{{ car.image }}" alt="Car Image">
    <button class="next-btn" onclick="changeImage(1)">&#10095;</button>
  </div>
  
  <div class="car-info">
    <p><strong>Marca:</strong> {{ car.brand }}</p>
    <p><strong>Anno:</strong> {{ car.year }}</p>
    <p><strong>Descrizione:</strong> {{ car.description }}</p>
    <p><strong>Modello:</strong> {{ car.model }}</p>
    <p><strong>Motore:</strong> {{ car.engine }}</p>
  </div>

  {% if current_user.is_authenticated %}
      {% if is_favorite %}
          <form action="{{ url_for('remove_from_favorites', car_id=car.id) }}" method="post">
              <button type="submit" class="remove-favorite">
                  <i class="fas fa-heart"></i> Rimuovi dai Preferiti
              </button>
          </form>
      {% else %}
          <form action="{{ url_for('add_to_favorites', car_id=car.id) }}" method="post">
              <button type="submit" class="add-favorite">
                  <i class="fas fa-heart"></i> Aggiungi ai Preferiti
              </button>
          </form>
      {% endif %}
  {% else %}
      <p><a href="{{ url_for('login', next=request.path) }}">Accedi</a> per aggiungere ai preferiti.</p>
  {% endif %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        let images = {{ ([car.image] + car.images)|tojson }};  

        // Auto-chiusura dei messaggi flash dopo alcuni secondi
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                setTimeout(function() {
                    message.style.opacity = '0';
                    setTimeout(function() {
                        message.style.display = 'none';
                    }, 600); // tempo di transizione
                }, 3000); // 3 secondi prima della chiusura
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/car_detail.js') }}"></script>
{% endblock %}