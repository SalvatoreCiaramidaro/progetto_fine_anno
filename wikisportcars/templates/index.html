<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Icona della pagina -->
    <link rel="icon" type="image/png" href="../static/favicon/favicon.png">
    <title>WikiSportCars</title>
</head>
<body>
    <header>
        <h1>Benvenuti su WikiSportCars</h1>
        <nav>
            <div class="nav-left">
                <a href="{{ url_for('index') }}"><i class="fas fa-home"></i></a>
            </div>
            <div class="nav-center">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Cerca auto...">
                    <button id="search-button"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div class="nav-right">
                {% if current_user.is_authenticated %}
                    <span class="greeting">Ciao, {{ current_user.username }}!</span>
                {% endif %}
                <div class="dropdown">
                    <button class="dropbtn">Menu</button>
                    <div class="dropdown-content">
                        <a href="{{ url_for('favorites') }}">Preferiti</a>
                        {% if current_user.is_authenticated %}
                            <a href="{{ url_for('logout') }}">Logout</a>
                            <a href="{{ url_for('profile') }}">Profilo</a>
                        {% else %}
                            <a href="{{ url_for('login', next=request.path) }}">Login</a>
                            <a href="{{ url_for('register') }}">Registrati</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <h2>Macchine Disponibili</h2>
        <div id="search-results-container" style="display: none;">
            <h3>Risultati della ricerca</h3>
            <button id="clear-search" class="clear-btn">Mostra tutte le auto</button>
            <div id="search-results" class="car-list">
                <!-- I risultati della ricerca verranno inseriti qui -->
            </div>
        </div>
        
        <div id="all-cars-container">
            {% if not cars %}
                <p>Nessuna macchina disponibile.</p>
            {% else %}
                <div class="car-list" id="all-cars">
                    {% for car in cars %}
                        <div class="small-car-container">
                            <div class="small-car-image">
                                {% if car.image[0:4] == 'http' %}
                                    <img src="{{ car.image }}" alt="{{ car.name }}">
                                {% else %}
                                    <img src="{{ url_for('static', filename='images/' ~ car.image) }}" alt="{{ car.name }}">
                                {% endif %}
                            </div>
                            <div class="small-car-info">
                                <h3>{{ car.name }}</h3>
                                <p>{{ car.small_description }}</p>
                                <a href="{{ url_for('car_detail', car_id=car.id) }}">Dettagli</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </main>
    <br>
    <br>

  <footer>
    <p>&copy; 2025 WikiSportCars. Tutti i diritti riservati.</p>
  </footer>

  <script>
    function toggleMenu() {
      document.getElementById('dropdownMenu').classList.toggle('open');
    }
    
    // Funzione di ricerca AJAX
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const clearSearchButton = document.getElementById('clear-search');
        const searchResultsContainer = document.getElementById('search-results-container');
        const searchResults = document.getElementById('search-results');
        const allCarsContainer = document.getElementById('all-cars-container');
        
        // Funzione per eseguire la ricerca
        function performSearch() {
            const query = searchInput.value.trim();
            
            if (query.length < 1) {
                return;
            }
            
            // Mostra indicatore di caricamento
            searchResults.innerHTML = '<div class="loading">Ricerca in corso...</div>';
            searchResultsContainer.style.display = 'block';
            allCarsContainer.style.display = 'none';
            
            // Richiesta AJAX
            fetch(`/api/search?query=${encodeURIComponent(query)}&start_with=true`)
                .then(response => response.json())
                .then(data => {
                    // Pulisci i risultati precedenti
                    searchResults.innerHTML = '';
                    
                    if (data.cars.length === 0) {
                        searchResults.innerHTML = '<p>Nessun risultato trovato.</p>';
                        return;
                    }
                    
                    // Mostra i risultati
                    data.cars.forEach(car => {
                        const carElement = document.createElement('div');
                        carElement.className = 'small-car-container';
                        
                        const imgSrc = car.image.startsWith('http') 
                            ? car.image 
                            : `/static/images/${car.image}`;
                            
                        carElement.innerHTML = `
                            <div class="small-car-image">
                                <img src="${imgSrc}" alt="${car.name}">
                            </div>
                            <div class="small-car-info">
                                <h3>${car.name}</h3>
                                <p>${car.small_description}</p>
                                <a href="/car/${car.id}">Dettagli</a>
                            </div>
                        `;
                        
                        searchResults.appendChild(carElement);
                    });
                })
                .catch(error => {
                    console.error('Errore durante la ricerca:', error);
                    searchResults.innerHTML = '<p>Si Ã¨ verificato un errore durante la ricerca.</p>';
                });
        }
        
        // Event listener per il pulsante di ricerca
        searchButton.addEventListener('click', performSearch);
        
        // Event listener per la ricerca con invio
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Event listener per pulire la ricerca
        clearSearchButton.addEventListener('click', function() {
            searchInput.value = '';
            searchResultsContainer.style.display = 'none';
            allCarsContainer.style.display = 'block';
        });
    });
  </script>
</body>
</html>
